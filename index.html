

<!Doctype html>
<!-- Created by: Walter Rackley -->
<!-- Customer: HCS -->
<!-- Created On: 4/4/2017 -->
<html>
   <head>
      <title>Find Local Pets</title>
      <!-- Brings in the required JS libs -->
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-sanitize.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-resource.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-animate.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-touch.min.js"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css">
      <script src="ui-bootstrap-tpls-2.5.0.min.js"></script>
      <style>
         .card-deck {
         display: flex;
         justify-content: flex-start;
         flex-flow: row wrap; 
         align-items: stretch;
         }
         .card-deck .card {
         display: block;
         flex-basis: 20%; 
         }
      </style>
      <!-- Actual scripting logic for the Application -->
      <script>
         //this declares the HTML to be pushed to the user after it is dynamically created 
         var pets;
         //stadard declaration of the Angular JS application name, imports some needed modules in order for the code to compile correctly 
         var app = angular.module('findLocalPets', ['ngSanitize', 'ngResource']);
         app.config(['$sceProvider', function($sceProvider) {
             $sceProvider.enabled(false);
         }]);
         app.controller('findLocalPetsCtrl', function($scope, $http, $resource, $sce) {
         
             $scope.page = 0;

         
             //the GET parameters are strung together in an URL and uses JSONP and a callback for cross domain calls
         function getAnimals(zipCode, offSet) {
         //the GET parameters are strung together in an URL and uses JSONP and a callback for cross domain calls
         var petUrl = "https://api.petfinder.com/pet.find"
         console.log("Url: " + petUrl);
            console.log("Off set: " + offSet);
         $http({
         method: 'jsonp',
         url: petUrl,         
          jsonpCallbackParam: 'callback',
         params: {
         key: '7310a3202957b2aa5d90e0b18d9c4ce2',
         format: 'json',
         location: zipCode,
         offset: offSet,
         animal: angular.lowercase($scope.selectedAnimal),
         count: $scope.selectedRsltPerPage,
         sex: $scope.selectedSex
         }
         }).then(function successCallback(response) {
          console.log("success");
          console.log(response);
          $scope.pets = response.data.petfinder.pets.pet;
          $scope.petLength = ($scope.pets).length
          console.log("Length:" + $scope.petLength); 
         }, function errorCallback(response) {
            console.log(response);
         });
         }
             $scope.cardClicked = function(name) {
                 console.log("Card Clicked" + name);
                 $scope.showModal = !$scope.showModal;
             }
             $scope.findPets = function() {
                 //calls the PetFinderAPI passing in the user inputed zipCode and number of results for each pet type
                 $scope.page = 0;
                 getAnimals($scope.inputData.zipCode,0);
                 console.log(pets);
                 console.log("Zip Code:" + $scope.inputData.zipCode);
         
             }
             $scope.clearResults = function() {
                 $scope.inputData.zipCode = "";
                 $scope.inputData.numDogs = "";
                 $scope.inputData.numCats = "";
                 $scope.searchResults = "";
             }
             $scope.getPic = function(picUrl) {                
                return picUrl;
             }
             $scope.changePage = function(isFoward) {
                var offSet;
                if(isFoward) {
                   $scope.page += 1;
                   offSet = $scope.page*$scope.selectedRsltPerPage;
                   getAnimals($scope.inputData.zipCode,offSet);
                } else if(!isFoward && $scope.page > 0) {
                   $scope.page -= 1;
                   offSet = $scope.page*$scope.selectedRsltPerPage;
                   getAnimals($scope.inputData.zipCode,offSet);
                }
                console.log("Page: " + $scope.page);
                window.scrollTo(0,0);
             }
         
         });
      </script>
   </head>
   <!-- Declares the name of the app -->
   <body ng-app="findLocalPets">
      <!-- declares the name of a controller to be used in angularjs code -->
      <div ng-controller="findLocalPetsCtrl">
         <!-- Declares the name of the form, will be used to validate entries in angularjs -->
         <nav class="navbar navbar-light bg-faded">
            <form class="form-inline">
               <input class="form-control mr-sm-2" type="text" placeholder="Zip Code" ng-model="inputData.zipCode" ng-pattern="/^\d{5}(?:[-\s]\d{4})?$/" required>
               <button class="btn btn-outline-success my-2 my-sm-0" ng-click="findPets()" type="submit">Search</button>
               
               <select ng-model="selectedAnimal" ng-change="findPets()" ng-show="pets" class="custom-select mb-2 mr-sm-2 mb-sm-0" style="float: right;" value="">
                 <option selected value>Both</option>
                 <option value="Cat">Cat</option>
                 <option value="Dog">Dog</option>
               </select>
               <span ng-show="pets" class="label label-default" style="float: right;">Animal Type </span>
               <select ng-model="selectedSex" ng-change="findPets()" ng-show="pets" class="custom-select mb-2 mr-sm-2 mb-sm-0" style="float: right;" value="">
                  <option selected value>Both</option>
                 <option value="M">Male</option>
                 <option value="F">Female</option>
               </select>
               <span ng-show="pets" class="label label-default" style="float: right;">Gender </span>
              <select ng-model="selectedRsltPerPage" ng-change="findPets()" class="custom-select mb-2 mr-sm-2 mb-sm-0" style="float: right;" value="">
                 <option selected value>25</option>
                 <option value="50">50</option>
                 <option value="100">100</option>
               </select> 
               <span class="label label-default" style="float: right;">Results per Page </span>
            </form>
         </nav>
         <!-- this is where the search results are pushed to the user -->
         <div class="container-fluid">
            <div class="card-deck">
               <div class="card" ng-click="cardClicked(pet.id.$t)" ng-repeat="pet in pets | orderBy: 'name.$t'">
                  <div style="text-align: center;">
                  <img class="card-img-top" style="align: center;" ng-src="{{getPic(pet.media.photos.photo[3].$t)}}" alt="No image found">
                  </div>
                  <div class="card-block">
                     <h4 class="card-title">{{pet.name.$t}}</h4>
                     <p class="card-text">
                        <small class="text-muted">
                           {{pet.sex.$t=="M"?"Male":"Female"}} {{pet.animal.$t}}                  
                     <p><span class="label label-default" ng-hide="angular.isArray(pet.breeds.breed)">{{pet.breeds.breed.$t}}</span>
                     <span class="label label-default" ng-repeat="(k, breed) in pet.breeds.breed">{{breed.$t}}</span></p>
                     </small>
                     </p>
                     <div class="card-text">
                        City: {{pet.contact.city.$t}}
                        <br>
                        State: {{pet.contact.state.$t}}
                        <br>
                        Zip: {{pet.contact.zip.$t}}
                        <br>
                        ID: {{pet.id.$t}}
                        <br>
                     </div>
                     <p class="card-text">
                        <small class="text-muted">
                        <span class="label label-default" ng-repeat="(k, option) in pet.options.option">{{option.$t}}</span>
                        <br>
                        <a ng-href="mailto:{{pet.contact.email.$t}}">Email Contact</a>
                        </small>
                     </p>
                  </div>
               </div>
            </div>
         </div>
         <div class="container" ng-show="pets">
            <div style="padding-bottom: 30px;"><button type="button" class="btn" style="float: left;" ng-show="page>0" ng-click="changePage(false)">Previous</button><button type="button" class="btn" style="float: right;" ng-show="page<25" ng-click="changePage(true)">Next</button></div>
            <div style="text-align: center;"><small ng-show="true" class="text-muted">Â©2017</small></div>
         </div>
      </div>
   </body>
</html>

