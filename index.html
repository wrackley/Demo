<!Doctype html>
<!-- Created by: Walter Rackley -->
<!-- Customer: HCS -->
<!-- Created On: 4/4/2017 -->
<html>

<head>
    <title>Find Local Pets</title>
    <!-- Brings in the required JS libs -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-sanitize.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.7/angular-resource.min.js"></script>
    <!-- Removes the bullet points for unordered lists, makes it neater -->
    <style>
        ul {
            list-style-type: none;
        }
    </style>
    <link rel="stylesheet" href="semantic.css">
    <!-- Actual scripting logic for the Application -->
    <script>
        //this declares the HTML to be pushed to the user after it is dynamically created 

        //stadard declaration of the Angular JS application name, imports some needed modules in order for the code to compile correctly 
        var app = angular.module('findLocalPets', ['ngSanitize', 'ngResource']);
        app.config(['$sceProvider', function($sceProvider) {
            $sceProvider.enabled(false);
        }]);
        app.controller('findLocalPetsCtrl', function($scope, $http, $resource, $sce) {
            var pets = [];
            $scope.pets = [];

            function getAnimals(animal, zipCode, count) {
                //the GET parameters are strung together in an URL and uses JSONP and a callback for cross domain calls
                var url = "https://api.petfinder.com/pet.find?key=7310a3202957b2aa5d90e0b18d9c4ce2&animal=" + animal + "&location=" + zipCode + "&count=" + count + "&format=json&callback=JSON_CALLBACK";
                $http.jsonp(url)
                    .success(function(data) {
                        pets = pets.concat(data.petfinder.pets.pet);
                    })
                    //in case the API can't be reached for some reason or some unexpected error arises, the page returns an error code
                    .error(function(data, status, headers, config) {

                    });

            }
            $scope.findPets = function() {    
                //calls the PetFinderAPI passing in the user inputed zipCode and number of results for each pet type
                getAnimals("cat", $scope.inputData.zipCode, $scope.inputData.numCats);
                getAnimals("dog", $scope.inputData.zipCode, $scope.inputData.numDogs);
                console.log(pets);
                $scope.pets = pets;
                console.log($scope.pets);
                pets = [];
                console.log("Zip Code:" + $scope.inputData.zipCode);

            }
            $scope.clearResults = function() {
                $scope.inputData.zipCode = "";
                $scope.inputData.numDogs = "";
                $scope.inputData.numCats = "";
                $scope.searchResults = "";
                html = "";
            }

        });
    </script>
</head>
<!-- Declares the name of the app -->

<body ng-app="findLocalPets">
    <!-- declares the name of a controller to be used in angularjs code -->
    <div ng-controller="findLocalPetsCtrl">
        <!-- Declares the name of the form, will be used to validate entries in angularjs -->
        <div class="ui menu">
            <div class="item">
                <div class="ui action input">
                    <span class="item">Zip Code: </span>
                    <input type="text" placeholder="Zip Code" ng-model="inputData.zipCode" ng-pattern="/^\d{5}(?:[-\s]\d{4})?$/" required>
                    <span class="item">Number of Dogs</span>
                    <input type="text" placeholder="Number of Dogs" ng-model="inputData.numDogs" ng-pattern=" /^[-+]?\d+$/">
                    <span class="item">Number of Cats</span>
                    <input type="text" placeholder="Number of Cats" ng-model="inputData.numCats" ng-pattern=" /^[-+]?\d+$/" required>
                    <div class="ui button" ng-click="findPets()">Search</div>
                </div>
        </div>
            </div>
        <!-- this is where the search results are pushed to the user -->
        
            <div class="ui link cards">
                <div class="card" ng-repeat="pet in pets | orderBy: 'name.$t'">                      
                    <div class="image">
                        <img ng-src="{{pet.media.photos.photo[3].$t}}" alt="No Image Found">
                    </div>
                        <div class="content">
                            <a class="header">{{pet.name.$t}}</a>
                            <div class="meta">
                                <span class="animal">{{pet.sex.$t=="M"?"Male":"Female"}} {{pet.animal.$t}}</span>
                                <br>
                                <span class="breed" ng-show="(pet.breeds.breed.length>0)||(pet.breeds.breed=!(angular.isArray(pet.breeds.breed)))">Breed: </span>
                                <div class="ui label" ng-hide="(angular.isArray(pet.breeds.breed))||(pet.breeds.breed.$t='')">{{pet.breeds.breed.$t}}</div>
                                <div class="ui label" ng-repeat="(k, breed) in pet.breeds.breed">{{breed.$t}}</div>
                            </div>
                            <div class="description">
                                <p>City: {{pet.contact.city.$t}}</p>
                                <p>State: {{pet.contact.state.$t}}</p>
                                <p>Zip: {{pet.contact.zip.$t}}</p>
                                <p>ID: {{pet.id.$t}}</p>
                            </div>
                            <div class="extra content">
                                <div></div>
                                <div class="ui label"  ng-repeat="(k, option) in pet.options.option">{{option.$t}}</div>
                                <a ng-href="mailto:{{pet.contact.email.$t}}">
                                    <br>                                    
                                    Email Contact
                                </a>
                            </div>
                        </div>
                </div>
            </div>
        </div>      
</body>

</html>
